version: '3'

services:
    db:
        image: mysql:latest
        volumes:
            - "./docker/db:/var/lib/mysql"
        ports:
            - "${MYSQL_PORT}:3306"
        environment:
            - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
            - MYSQL_USER=${SF_DB_USER}
            - MYSQL_PASSWORD=${SF_DB_PWD}
            - MYSQL_DATABASE=${SF_DB_NAME}
        networks:
            - back

    phpmyadmin:
        image: phpmyadmin/phpmyadmin:latest
        ports:
            - "${PHP_MY_ADMIN_PORT}:80"
        links:
          - db:mysql
        networks:
            - back

    app-back:
        build:
            context: ./docker/back
            dockerfile: ./Dockerfile
        ports:
            - "${HOST_PORT}:80"
            - "9090:9090"
        environment:
            - SF_ENV=${SF_ENV}
            - SF_DB_USER=${SF_DB_USER}
            - SF_DB_PWD=${SF_DB_PWD}
            - SF_DB_NAME=${SF_DB_NAME}
        volumes:
            - "${APP_DIR}:/var/www/html"
            - "${COMPOSER_DIR}:/root/.composer"
            - "./docker/back/log:/var/log"
        links:
            - db
        networks:
            - back

networks:
    front:
    back:
